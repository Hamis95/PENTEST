#H5

**a)**

Aloitin tehtävän pystyttämällä **metasploit2** koneen ja halusin ohjeiden mukaan ottaa käyttöön virtual host-only-networkin, mutta tässä oli hieman ongelmia, koska olin unohtanut poistaa host only networkistä DHCP:n.
Tämän huomattuani kali sai metasploittiin yhteyden ja homma alkoi pelaamaan.

Ajoin aluksi käskyn ```sudo nmap -sV 192.168.56.102``` ja tulokseksi tuli:

![nampb](https://github.com/Hamis95/PENTEST/blob/main/metasploit1.png?raw=true)

Portteja on siis auki monta ja palveluita myös.

Kun olin varmistanut että kone toimii ja pystyn skannaamaan sen portit niin avasin metasploitin konsolin ja aloitin haavoittuvuuksien etsimisen.

Aloitin ftp palvelusta ja hain haavoittuvuudet käskyllä ```search vsftpd 2.3.4```

![nampb](https://github.com/Hamis95/PENTEST/blob/main/metasploit2.png?raw=true)

Otin sitten exploitin käyttöön ja määritin RHOSTIN kohteen ip osoitteeksi.

Käskyllä **exploit** ohjelma aloitti exploittaamisen ja nopeasti sain shellin käyttöön.
shellissä ollessani käskyllä **whoami** palautti vastaukseksi **root**, joten kone on korkattu ftp:n kautta.

Seuraavaksi katsoin, mistä palveluista nmap oli printannut selkeän version ja MySQL on tuttu palvelu, joten halusin kokeilla sille murtautumista.
Jos metasploitin hakuun kirjoitti koko version niin ei löytynyt exploittia, mutta haulla ```search MySQL 5``` printtaantui 20 eri exploittia.

![nampb](https://github.com/Hamis95/PENTEST/blob/main/metasploit3.png?raw=true)

Nästä matalimmalla roikkuvalta omenalta vaikuttaa "login" exploitti eli numero **4**, joten päätin kokeilla tätä.

**show options** käskyllä sain lisää tietoa exploitista ja tajusin, että kyseessä on brute force hyökkäys ja tässä pitää määritellä hyökkäyksen parametrit.
![nampb](https://github.com/Hamis95/PENTEST/blob/main/metasploit4.png?raw=true)

Aloin siis syöttämään parametreja:

* set USERNAME root
* set PASS_FILE /usr/share/wordlists/rockyou.txt (tämä on erittäin basic sanalista mahdollisille salasanoille)
* set STOP_ON_SUCCESS (koska käyttäjä on määritelty rootiksi, niin ensimmäinen osuma riittää)

Tämän juoksemiseen käsky **run** ja 2 sec päästä terminaali printtasi, että rootilla ei ole salasanaa, joten sanalistan lisääminen oli turhaa.

Seuraavaksi kokeilen exploittaa VNC 3.3 palvelua ja tälle löytyi login exploit.

![nampb](https://github.com/Hamis95/PENTEST/blob/main/metasploit5.png?raw=true)

Käskyllä **exploit** tulostui VNC salasanaksi **password**


Seuraavaksi hain palvelulle **UnrealIRCd** haavoittuvuuksia ja sille löytyi yksi haavoittuvuus, josta löytyi monta eri payloadia.

![nampb](https://github.com/Hamis95/PENTEST/blob/main/metasploit6.png?raw=true)

valitsin ensimmäisen payloadin ja juoksin sen käskyllä exploit. Muutaman kymmenen sekunnin jälkeen sain itselleni rootin.

[Lähde](http://cs.uccs.edu/~cs591/metasploit/users_guide3_1.pdf)

**b)**
Käynnistän ensimmäiseksi HTB vpn yhteyden
Avaan metasploitin konsolin ja luon työympäristön käskyllä ```> workspace -a HTB```, jotta kerättävä data kerääntyy tiettyyn paikkaan.

vaiheittain
* juoksen käskyn ```db_nmap -sV 10.10.10.190-225``` (koska tiedän aikaisemmista skanneista, että tällä alueella ovat toimivat koneet)
* ```services``` käskyllä printtaantuu palvelut ja portit. (tämä kaikki on siis tallentunut workspacen tietoihin ja kun workaspacen ottaa käyttöön niin nämä tiedot saa tällä käskyllä myöhemminkin.

![nampb](https://github.com/Hamis95/PENTEST/blob/main/metasploit7.png?raw=true)

**c)**

Edellisestä kuvasta näkyy koneiden palveluita ja niitä hakemalla löytyy, että:

* koneen 10.10.10.96 portissa 8000 pyörivä werkzeug 0.14.1 on haavoittuvainen.
* nginx 1.3.9-1.4.0 on haavoittuvainen buffer overflow exploitille
* koneen 10.10.10.97 imap palvelulle on php remote execution haavoittuvuus

**z)**

**Metasploitin perusteet**
* Exploitti eli koodi, jonka juoksemalla pystytään hyödyntämään kohteen haavoittuvuutta
* Payload on koodi joka pyörii kohteessa exploit vaiheen jälkeen.
* Auxialiary eli moduulit, jotka antavat lisäominaisuuksia esim. skannaus, fuzzaus yms.
* Encoders ovat tapa, jolla hyökkäys koitetaan pilottaa. Ne estävät esim. viruksentorjunnan.
* Meterpreter on payload, joka käyttää in-memory DLL hyväkseen.

[Lähde](https://learning.oreilly.com/library/view/mastering-metasploit-/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-30)

