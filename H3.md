# H3

**a)**
Tässä tehtävässä otin kohteeksi hacktheboxin buff koneen, jonka ip osoite oli:
```10.10.10.198```
Ensimmäiseksi kokeilen TCP connect scannia, jossa kartoitetaan kohteen avoimia portteja TCP protokolaa hyväksikäyttäen. Se skannaa TCP:tä hyödyntävien ohjelmien portteja ja raportoi kohdekoneen vastaukset. Ei vastausta = portti kiinni, Vastaus = portti auki.
Juoksin koneeseen käskyn ```$ sudo nmap -sT 10.10.10.198 -v``` . Samalla pistin wiresharking kuuntelemaan tun0 (openVPN) liitäntää. nmap tulosti seuraavan tuloksen käskyn suoritettuaan:
```Discovered open port 8080/tcp on 10.10.10.198
Completed Connect Scan at 14:21, 8.81s elapsed (1000 total ports)
Nmap scan report for 10.10.10.198
Host is up (0.11s latency).
Not shown: 999 filtered ports
PORT     STATE SERVICE
8080/tcp open  http-proxy 
```

nmap siis skannasi 1000 porttia kohdeosoitteesta ja vain yksi oli niistä auki. Kohdekone on siis toiminnassa ja sitä pystyy skannaamaan.

Wireshark

![nampb](https://github.com/Hamis95/PENTEST/blob/main/wireshark1.png?raw=true)
TCP connect scannissa kohdekone vastaa siis vain kaksi kertaa moneen pyyntöön. Kohdekone vastaa ICMP ping pyyntöön, josta ei selviä muuta kun se että koneeseen saa yhteyden. Huom. että nmapissa voi erikseen käskyllä -Pn jättää ICMP ping pyynnön tekemättä, jos tietää koneen olevan toiminnassa.  Kohdekone vastaa myös porttiin 8080 kohdistettuun **SYN** pyyntöön:
```16	0.244026930	10.10.10.198	10.10.14.133	TCP	52	8080 → 59768 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=1357 WS=256 SACK_PERM=1```

Tästä voi päätellä että portti **8080** on auki kohdekoneessa.

Seuraavaksi **TCP SYN scan**. Tämän ajoin terminaalissa käskyllä ```$ sudo nmap -sS 10.10.10.198 -v``` . Tässä metodissa wireshark palauttaa paljon enemmän dataa. SYN scan eroaa TCP connect scannista siten, että se ei vie TCP kättelyä loppuun asti, vaan sulkee yhteyden heti **RST** pyynnöllä. Tällöin TCP yhteyttä ei muodosteta.
Wiresharkkiin ilmesty tämän pyynnön tehtyä 2021 pakettia, jotka eivät antaneet enempää tietoa kun TCP connect.
SYN scannin suurimpia etuja on, että se ei jätä kohteeseen yhtä paljon lokitietoja ja on näin "salaisempi" metodi skannata portteja.

Seuraavaksi **Ping Sweep**. Tämän ajoin terminaalissa käskyllä ```$ sudo nmap -sn 10.10.10.0/24 -v``` Tämä komento on tarkoitettu hostin löytämiseen ja sen ajaminen yhteen. Scannasin siis hack the boxin verkon ja tulokseksi sain ```Nmap done: 256 IP addresses (24 hosts up) scanned in 10.12 seconds``` nmap siis löysi 24 aktiivista hostia skannattuaan 256 IP osoitetta. Tämä käsky tekee saman kun se, että pingaisi manuaalisesti 10.10.10.0 verkon jokaisen mahdollisen osoitteen. Siinä menisi ikä ja terveys, mutta onneksi nmap suoritti tämän 10,12 sekunissa, joten olen vain marginaalisesti vanhempi kuin aloittaessa.

Seuraavaksi **Don't ping** Tästä jo selitinkin TCP scan tehtävässä, mutta kun lisää nmappiin parametrin **-Pn** niin nmap jättää ICMP pingin tekemättä skannauksen alussa. Tätä parametriä on hyvä käyttää, jos kohdekoneen status on selvinnyt jo aikasempien käskyjen perusteella. Esimerkkinä tehtyäni TCP connect scannin nmap teki ICMP ping pyynnön kohdekoneeseen, joten TCP syn skanniin olisi hyvin voinut lisätä parametrin -Pn. Hosti siis jätetään tunnistamatta.

Seuraavaksi **Version detection**. Tämän ajoin terminaalissa käskyllä ```$ sudo nmap -sV 10.10.10.198 -v``` Tällä käskyllä nmap skannaa kohteesta 1000 porttia ja tutkii niissä pyörivät palvelut ja niiden versiot. Tämän nmap tekee nmap-service-probes databasen avulla. Se lähettää queryt jokaiseen avoimeen porttiin, ja yhdistää toimivat queryt palvelun versioon. Minulla oli jo tiedossa, että kohteessani on portti 8080 auki ja siellä pyörii HTTP-proxy, mutta en tiennyt mikä HTTP palvelinohjelma siellä pyörii.
Kun nmap oli valmis niin se tulosti terminaaliin:
```
PORT     STATE SERVICE VERSION
8080/tcp open  http    Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)
```
Nyt sain selville että portti 8080 pyörii **Apache 2.4.43**
![nampb](https://github.com/Hamis95/PENTEST/blob/main/wireshark2.png?raw=true)
Wireshakissa näkyy, että nmap on lähettänyt GET pyyntöjä kohdekoneen porttiin 8080. GET pyynnön sisällä on ollut queryt, minkä avulla palvelun versio ollaan saatu tunnistettua.

**b)** 

**-p1-100 ja --top-ports 5 parametrit**. Testasin näitä komennolla ```$ sudo nmap -p1-100 --top-ports 10.10.10.198 -v```. Tämä komento printtasi terminaaliin:
```
PORT   STATE    SERVICE
21/tcp filtered ftp
22/tcp filtered ssh
23/tcp filtered telnet
25/tcp filtered smtp
80/tcp filtered http
```
Eli käsky siis näyttää 5 suosituinta porttia rangelta 1-100. Käsky kertoo myös palveluiden nimet ja niiden tilat.

Seuraavaksi **IP-osoitteiden rangen valinta**. Tässä käytin esimerkkinä käskyä ```sudo nmap -sn 10.10.10.0/24 -v``` jolloin nmap skannaa kaikki verkossa 10.10.10.0/24 olevat hostit. ```sudo nmap -sn 10.10.10.0-100``` käskyllä taas rajoitan hostien hakua sataan ensimmäiseen osoitteeseen. Tämän parametrin tarkoitus on rajata skannausta, jotta sen kesto ei olisi niin pitkä. Rajauksessa hyödynnetään yleensä aikaisempaa tietoa kohteesta.

Seuraavaksi **Output files**. Tässä käytin esimerkkinä käskyä ```$ sudo nmap -sC -sV -oA recon 10.10.10.198 -v```, jolloin telminaaliin printtaantuu:
```
ORT     STATE SERVICE VERSION
8080/tcp open  http    Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-open-proxy: Potentially OPEN proxy.
|_Methods supported:CONNECTION
|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6
|_http-title: mrb3n's Bro Hut
```
Komento siis tekee TCP-syn skannauksen, Versio tunnistamisen, käyttöjärjestelmän tunnistamisen. -oA parametri printtaa recon nimiset tiedostot gnmap, nmap ja xml muodoissa.

Version skannauksen tenkin jo aikaisemmassa tehtävässä käskyllä ```$ sudo nmap -sV 10.10.10.198 -v``` ja se tulosti:
```
PORT     STATE SERVICE VERSION
8080/tcp open  http    Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)
```

Seuraavaksi **OS fingerprinting, version detection, scripts, traceroute -A**.
-A parametri tosiaan tutkii kaikki nämä atribuutit ja on helppokäyttöinen ja lyhyt käsky. Tämä parametri on nopeampi ja helpompi toteuttaa kun --kitchen-sink yms.

**Sudolla vai ilman?** sudo antaa nmapille root oikeudet, jolloin se pystyy tekemään enemmä asioita ja vapaammin. Joissakin komennoissa sudon poisjättäminen antaa vähemmän tuloksia, koska nmap ei pystynyt suorittamaan kaikkia toimintojaan. Sudon pois jättäminen on erittäin turhaa nmappia käyttäessä(ellei komenna suoraan rootilta)

Testasin -sV ja -A parametrejen kestoa käskyllä ```sudo nmap -sV 10.10.10.198 -v``` ja ```sudo nmap -A 10.10.10.198 -v```

-A komennon tulos:
```
Nmap done: 1 IP address (1 host up) scanned in 36.80 seconds
           Raw packets sent: 2092 (95.732KB) | Rcvd: 35 (2.124KB)
```
-sV komennon tulos:
```
Nmap done: 1 IP address (1 host up) scanned in 21.29 seconds
           Raw packets sent: 2008 (88.328KB) | Rcvd: 7 (292B)
```
-sV parametri on siis nopeampi, mutta käsittelee vähemmän paketteja ja dataa.


**c)**

Tehtävässä pitää laittaa http serveri pystyyn, joten tein tämän helpoimmalla mahdollisella tavalla. Käsky ```python -m SimpleHTTPServer``` käynnistää porttiin 8000 HTTP serverin erittäin nopeasti.
Tein versio skannauksen käskyllä ```$ sudo nmap -sV localhost -p 8000``` ja HTTP palvelimeen printtaantui.
![nampb](https://github.com/Hamis95/PENTEST/blob/main/wireshark3.png?raw=true)

Täältä paljastuu paketti nimeltä "/nmaplowercheck1606070932"


**d)**

-Yleisimpiä UDP portteja ovat DHCP(67,78), SNMP(161,162), DNS(53) ja NTP(123). Useat palvelut käyttävät molempia TCP ja UDP protocollia.
-Koska UDP ei varmenna pakettien vastaanottoa, joten sitä ei voi hyödyntää samalla tavalla kun ACK/SYN. UDP joudutaan skannaamaan TCP protokollan rinnalla.
--reason selittää skannattavan portin tilaa. 

**e)**

Tämä kokeiltiin jo tunnilla. Ladattuani OpenVPN ohjelman ja ladattuani oman .ovpn pakettini, niin yhteys lähti toimimaan käskyllä ```$ sudo openvpn /home/hamahe5/Downloads/xxxxxxxxxxx.ovpn```
Yhteyden toiminnan varmistin pingaamalla yhtä hacktheboxin koneista ja VPN status sivu näytti että yhteys toimii
![nampb](https://github.com/Hamis95/PENTEST/blob/main/OpenVPN.png?raw=true)
Olen myös koko tehtävä ajan käyttänyt "BUFF" konetta hyväkseni, joten koko tehtävä on todiste toimivasta VPN yhteydestä.

**f)**

Olen koko tehtävän ajan tiedustellut HackTheBoxin verkkoa, joten tiedän että sen verkossa pyörii 24 hostia. ```$ sudo nmap -sn 10.10.10.98 -v``` Käskyllä terminaaliin printtaantuu juuri tämä tieto.
```
Nmap done: 256 IP addresses (24 hosts up) scanned in 34.60 seconds
           Raw packets sent: 1887 (71.384KB) | Rcvd: 62 (2.916KB)
```
Kaikki ping sweeppiin vastaavat hostit olivat rangella 10.10.10.194-217, joten tein tälle rangelle top-ports skannauksen. ```$ sudo nmap --top-ports 5 10.10.10.194-217 -v```

Nyt tiedossani on verkon jokaisen hosti 5 suosituinta porttia väliltä 1-1000, mutta keskityn nyt koneeseen 10.10.10.198 jotta dataa ei tule liikaa. Tein koneelle versio skannauksen. ```$ sudo nmap -sV -Pn 10.10.10.198 -v```
Tällä komenolla sain tietää, että koneessa on yksi portti auki **8080** ja siellä pyörii **Apache 2.4.43**
Wiresharkilla tätä komentoa katsoessa nmap lähettää SYN tiedusteluita kaikkiin osoitteen portteihin ja ainoa mistä se saa vastauksen on portti 8080. Tämän jälkeen nmap alkaa lähettämään GET pyyntöjä HTTP protokollan kautta, jotta se saa tietoon 8080 portin palvelun version.
![nampb](https://github.com/Hamis95/PENTEST/blob/main/wireshark4.png?raw=true)
Tästä näkee miten nmap lähettää kohteeseen queryjä, jotta pystyy tunnistamaan palvelun version.

Bonus:

-apache-users ohjelmalla voi tutkia apachen käyttäjiä.
-Dirbuster tutkii apachen hakemistot
-WebSploit on myös monipuolinen ohjelma webbisivujen tutkimiseen.

**z)**

**Surveying essential tools**
- Passiivisessa tiedustelussa ei lähetetä mitään dataa kohteeseen
- Aktiivisessa tiedustelussa lähetetään dataa kohteeseen. Tästä voi jäädä jälkiä.
- nmap on yksi suosituimmista ja monipuolisimmista työkaluista aktiiviseen tiedusteluun, mutta nopeampi työkaluja on saatavilla

**nmap overview and demonstration**
- Yleinen katsaus nmappiin ja päästä keksitty esimerkkitapaus sen käytöstä
- Haavoittuvaisuuden arvioinnin ensimmäinen askel on verkon löytäminen, tämän jälkeen ip sweeppaus, tämän jälkeen palveluiden      kartoitus, verkon topologia ja palomuurin testaus.

**nmap manuaali**
-Paljon tietoa nmapista ja sen käyttötarkoituksista
-ohjeet miten nmappia käytetään (käskyt ja parametrit)

**porttiskannauksen perusteet**
-Open tarkoittaa, että sovellus hyväksyy TCP yhteydet, UDP datagrammit ja SCTP-yhteyksiä
-Closed tarkoittaa, että paketit menevät läpi, mutta mikään sovellus ei kuuntele porttia
-Filtered tarkoittaa, että nmap ei tiedä portin statusta koska sen lähettämät paketit filtteröidään
-unfiltered tarkoittaa, että porttiin saa yhteyden, mutta nmap ei tiedä onko portti auki vai kiinni. Tämä tapahtuu vain ACK skannauksissa

**nmap porttiskannaus tekniikat**
-sS TCP SYN skannaus. Kertoo porttien tilan. Tässä TCP yhteys testataan, mutta suljetaan heti kun kun yhteys meinataan muodostaa.
-sT TCP connect skannaus. Vaihtoehtoinen SYN skannaukselle, mutta ei yhtä "salainen".
-sU UDP skannaus. Vaikea ja hidas skannaus. Tämä haavoittuvuus jätetään usein huomioimatta ja on siksi varteenotettava
-sY SCTP skannaus. Puoli avoin skannaus.





